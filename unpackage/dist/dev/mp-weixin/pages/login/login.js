(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{57:function(e,n,t){"use strict";(function(e){t(5),t(6);r(t(4));var n=r(t(58));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t(1)["createPage"])},58:function(e,n,t){"use strict";t.r(n);var r=t(59),o=t(61);for(var a in o)"default"!==a&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t(63);var u,s=t(17),i=Object(s["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,"b237504c",null,!1,r["components"],u);i.options.__file="pages/login/login.vue",n["default"]=i.exports},59:function(e,n,t){"use strict";t.r(n);var r=t(60);t.d(n,"render",(function(){return r["render"]})),t.d(n,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(n,"components",(function(){return r["components"]}))},60:function(e,n,t){"use strict";var r;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return u})),t.d(n,"recyclableRender",(function(){return a})),t.d(n,"components",(function(){return r}));var o=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.username=n.mp.detail},e.e1=function(n){e.password=n.mp.detail})},a=!1,u=[];o._withStripped=!0},61:function(e,n,t){"use strict";t.r(n);var r=t(62),o=t.n(r);for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},62:function(e,n,t){"use strict";(function(e,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=a(t(7));function a(e){return e&&e.__esModule?e:{default:e}}function u(e,n,t,r,o,a,u){try{var s=e[a](u),i=s.value}catch(c){return void t(c)}s.done?n(i):Promise.resolve(i).then(r,o)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function s(e){u(a,r,o,s,i,"next",e)}function i(e){u(a,r,o,s,i,"throw",e)}s(void 0)}))}}var i=t(26),c=i.login,f=e.database(),l={data:function(){return{username:"",password:"",nickName:"",avatar:""}},mounted:function(){var e=r.getStorageSync("user");this.username=e.username,this.nickName=e.userInfo.nickName,this.avatar=e.userInfo.avatarUrl},methods:{login:function(){var e=this;return s(o.default.mark((function n(){var t,a,u,s,i,l;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.username&&e.password){n.next=3;break}return r.showToast({title:"账号密码不能为空",icon:"none"}),n.abrupt("return");case 3:return r.showLoading(),n.next=6,c(e.username,e.password);case 6:if(t=n.sent,200!=t.data.status){n.next=16;break}return r.showToast({title:"教务系统登录成功",icon:"none"}),setTimeout((function(){r.showLoading()}),1500),n.next=12,e.getUserProfile();case 12:a=n.sent,a.userInfo&&(u=a.userInfo,s=u.nickName,i=u.avatarUrl,l={userInfo:{nickName:s,avatarUrl:i},username:e.username,password:e.password},f.collection("users").where({openid:r.getStorageSync("openid")}).update(l).then((function(n){console.log(n),r.setStorageSync("user",{userInfo:{nickName:s,avatarUrl:i},username:e.username}),r.getStorage({key:"courses",success:function(e){console.log(e.data),e.data&&(r.hideLoading(),r.showModal({title:"提示",content:"切换用户的话存在旧数据，要点课表页左上角刷新数据，从而获取最新数据",complete:function(e){r.navigateBack()}}))}}),r.navigateBack()}))),n.next=23;break;case 16:if(401!=t.data.status){n.next=21;break}return r.showToast({title:"十分罕见验证码错误，请重新登录下",icon:"none"}),n.abrupt("return");case 21:return r.showToast({title:t.data.message,icon:"none"}),n.abrupt("return");case 23:case"end":return n.stop()}}),n)})))()},getUserProfile:function(){return new Promise((function(e,n){r.getUserProfile({desc:"获取您的微信信息以授权小程序",success:function(n){console.log("getUserProfile-res",n),e(n)},fail:function(e){r.showToast({title:"授权失败",icon:"error"}),console.log("getUserProfile-err",e),n(e)}})}))},copy_add:function(){r.setClipboardData({data:"http://211.86.128.194/suzxyjw",success:function(){r.showToast({title:"已复制地址,快去浏览器打开吧",icon:"none"})}})}},onShow:function(){}};n.default=l}).call(this,t(6)["default"],t(1)["default"])},63:function(e,n,t){"use strict";t.r(n);var r=t(64),o=t.n(r);for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},64:function(e,n,t){}},[[57,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map