(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"5adc":function(e,n,t){"use strict";t.r(n);var a=t("96e0"),r=t("5bba");for(var o in r)"default"!==o&&function(e){t.d(n,e,(function(){return r[e]}))}(o);t("9aef");var u,s=t("f0c5"),i=Object(s["a"])(r["default"],a["b"],a["c"],!1,null,"249053e0",null,!1,a["a"],u);n["default"]=i.exports},"5bba":function(e,n,t){"use strict";t.r(n);var a=t("8b08"),r=t.n(a);for(var o in a)"default"!==o&&function(e){t.d(n,e,(function(){return a[e]}))}(o);n["default"]=r.a},"8b08":function(e,n,t){"use strict";(function(e,a){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t("a34a"));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,n,t,a,r,o,u){try{var s=e[o](u),i=s.value}catch(c){return void t(c)}s.done?n(i):Promise.resolve(i).then(a,r)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(a,r){var o=e.apply(n,t);function s(e){u(o,a,r,s,i,"next",e)}function i(e){u(o,a,r,s,i,"throw",e)}s(void 0)}))}}var i=t("175b"),c=i.login,f=e.database(),l={data:function(){return{username:"",password:"",nickName:"",avatar:""}},mounted:function(){var e=a.getStorageSync("user");this.username=e.username,this.nickName=e.userInfo.nickName,this.avatar=e.userInfo.avatarUrl},methods:{login:function(){var e=this;return s(r.default.mark((function n(){var t,o,u,s,i,l;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.username&&e.password){n.next=3;break}return a.showToast({title:"账号密码不能为空",icon:"none"}),n.abrupt("return");case 3:return a.showLoading(),n.next=6,c(e.username,e.password);case 6:if(t=n.sent,200!=t.data.status){n.next=16;break}return a.showToast({title:"教务系统登录成功",icon:"none"}),setTimeout((function(){a.showLoading()}),1500),n.next=12,e.getUserProfile();case 12:o=n.sent,o.userInfo&&(u=o.userInfo,s=u.nickName,i=u.avatarUrl,l={userInfo:{nickName:s,avatarUrl:i},username:e.username,password:e.password},f.collection("users").where({openid:a.getStorageSync("openid")}).update(l).then((function(n){console.log(n),a.setStorageSync("user",{userInfo:{nickName:s,avatarUrl:i},username:e.username}),a.getStorage({key:"courses",success:function(e){console.log(e.data),e.data&&(a.hideLoading(),a.showModal({title:"提示",content:"切换用户的话存在旧数据，要点课表页左上角刷新数据，从而获取最新数据",complete:function(e){a.navigateBack()}}))}}),a.navigateBack()}))),n.next=23;break;case 16:if(401!=t.data.status){n.next=21;break}return a.showToast({title:"十分罕见验证码错误，请重新登录下",icon:"none"}),n.abrupt("return");case 21:return a.showToast({title:t.data.message,icon:"none"}),n.abrupt("return");case 23:case"end":return n.stop()}}),n)})))()},getUserProfile:function(){return new Promise((function(e,n){a.getUserProfile({desc:"获取您的微信信息以授权小程序",success:function(n){console.log("getUserProfile-res",n),e(n)},fail:function(e){a.showToast({title:"授权失败",icon:"error"}),console.log("getUserProfile-err",e),n(e)}})}))},copy_add:function(){a.setClipboardData({data:"http://211.86.128.194/suzxyjw",success:function(){a.showToast({title:"已复制地址,快去浏览器打开吧",icon:"none"})}})}},onShow:function(){}};n.default=l}).call(this,t("a9ff")["default"],t("543d")["default"])},"96e0":function(e,n,t){"use strict";var a;t.d(n,"b",(function(){return r})),t.d(n,"c",(function(){return o})),t.d(n,"a",(function(){return a}));var r=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.username=n.mp.detail},e.e1=function(n){e.password=n.mp.detail})},o=[]},"9aef":function(e,n,t){"use strict";var a=t("b634"),r=t.n(a);r.a},b634:function(e,n,t){},ff82:function(e,n,t){"use strict";(function(e){t("343f"),t("a9ff");a(t("66fd"));var n=a(t("5adc"));function a(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])}},[["ff82","common/runtime","common/vendor"]]]);